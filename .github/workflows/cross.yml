name: Cross-platform Release

on:
  push:
    tags:
      - "v*"

permissions:
  contents: write  # needed to create releases

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
    # 1️⃣ Checkout the repo
    - uses: actions/checkout@v4

    # 2️⃣ Build Linux binary
    - name: Build Linux binary
      run: gcc src/main_linux.c -o my_program-linux

    # 3️⃣ Build Windows binary (cross-compile using mingw-w64)
    - name: Build Windows binary
      run: sudo apt-get install -y mingw-w64 && \
           x86_64-w64-mingw32-gcc src/main_windows.c -o my_program-windows.exe

    # 4️⃣ Read README.md as release notes
    - name: Read README.md
      id: readme
      run: |
        echo "content<<EOF" >> $GITHUB_OUTPUT
        cat README.md >> $GITHUB_OUTPUT
        echo "EOF" >> $GITHUB_OUTPUT

    # 5️⃣ Create GitHub Release and upload binaries
    - name: Create GitHub Release
      uses: softprops/action-gh-release@v2
      with:
        name: Release ${{ github.ref_name }}
        body: ${{ steps.readme.outputs.content }}
        files: |
          my_program-linux
          my_program-windows.exe
